<p>
    In almost every project I end up using at some point the <a href="https://blog.appsignal.com/2020/06/17/using-service-objects-in-ruby-on-rails.html" alt="Service Object Pattern">Service Object pattern</a>. I like
    because of the convention of naming the class with what the PORO<label for="sn-7" class="sidenote-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="sidenote-toggle">
    <span class="sidenote left">
        Don't you love acronyms? I certainly do. To me, it's the similar abstraction like verbing nouns i.e. <ins>google it</ins> instead <em> of go to the internet and use the search engine Google to find it</em>. The word <em>Internet</em> is another one. This is fun.
    </span> does: <code>CreateRefund.call</code>. You know by reading the class name what's happening in same or <em>what should be happening inside</em>.
</p>
<p>
    However, I don't follow all the rules. For example, I don't create a <mark>class</mark> but rather a <mark>module</mark>. Instead of doing the following:
</p>
<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="background-color:transparent;margin: 0; line-height: 125%"><span style="color: #66d9ef">module</span> <span style="color: #f8f8f2">StripeServices</span>
  <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">CreateSubscription</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">initialize</span><span style="color: #f8f8f2">(params)</span>
      <span style="color: #f8f8f2">@subscription_params</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">params</span><span style="color: #f92672">[</span><span style="color: #e6db74">:subscription_params</span><span style="color: #f92672">]</span>
    <span style="color: #66d9ef">end</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">call</span>
      <span style="color: #f8f8f2">subscription</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">Stripe</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">:Subscription</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">create(@subscription_params)</span>
    <span style="color: #66d9ef">rescue</span> <span style="color: #e6db74">Stripe</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">:StripeError</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">e</span>
      <span style="color: #66d9ef">OpenStruct</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new({success?:</span> <span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">error</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">e})</span>
    <span style="color: #66d9ef">else</span>
      <span style="color: #66d9ef">OpenStruct</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new({success?:</span> <span style="color: #66d9ef">true</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">payload</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">subscription})</span>
    <span style="color: #66d9ef">end</span>
  <span style="color: #66d9ef">end</span>
<span style="color: #66d9ef">end</span>
    </pre>
</div>
<p>
    I will use modules only:
</p>
<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="background-color:transparent;margin: 0; line-height: 125%"><span style="color: #66d9ef">module</span> <span style="color: #f8f8f2">Stripe</span>
  <span style="color: #66d9ef">module</span> <span style="color: #f8f8f2">CreateSubscription</span>
    <span style="color: #66d9ef">module_function</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">call</span><span style="color: #f8f8f2">(subscription_params)</span>
      <span style="color: #f8f8f2">subscription</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">Stripe</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">:Subscription</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">create(subscription_params)</span>
    <span style="color: #66d9ef">rescue</span> <span style="color: #e6db74">Stripe</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">:StripeError</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">e</span>
      <span style="color: #66d9ef">OpenStruct</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new({success?:</span> <span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">error</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">e})</span>
    <span style="color: #66d9ef">else</span>
      <span style="color: #66d9ef">OpenStruct</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new({success?:</span> <span style="color: #66d9ef">true</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">payload</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">subscription})</span>
    <span style="color: #66d9ef">end</span>
  <span style="color: #66d9ef">end</span>
<span style="color: #66d9ef">end</span>
    </pre>
</div>
<p>
    Notice that I try not to use the name of the pattern in the <a href="https://sender.cloudy.email/campaigns/paxjhchaiasjoifsiw/webversion/jdnapfbdgjegdqmdeduwc" alt="Don't Name Classes After Patterns. Mostly.">class name</a>.
    The reason is because the pattern name will be visible in the backtrace. When it comes to your IDE, the class will be inside <code>app/services</code>. The redundancy is not needed there.
</p>
<p>
    Now, why do I use module instead of a class? To be honest, my answer has not evidence to back it up. In fact, that's the reason of this post, to find out how my beliefs are wrong 
    or perhaps right, I dunno. My reason to choose a module instead of a class was because I didn't want to initialize more objects (less object creation). 
    I have never done the benchmarks. I only know that <em>modules</em> are not initialized. is it, though?
</p>
<figure>
    <img src="elders.gif" alt="The Elders of the Internet"/>
    <figcaption>
        From IT Crowd TV show
    </figcaption>
</figure>
<p>
    First, some benchmarks in with two dummy functions:
</p>
<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="background-color:transparent;margin: 0; line-height: 125%"><span style="color: #75715e">#!/usr/bin/env ruby</span>
<span style="color: #75715e"># frozen_string_literal: true</span>

<span style="color: #66d9ef">module</span> <span style="color: #f8f8f2">M</span>
  <span style="color: #66d9ef">module</span> <span style="color: #f8f8f2">DivideToNumbers</span>
    <span style="color: #66d9ef">module_function</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">call</span><span style="color: #f8f8f2">(x,</span> <span style="color: #f8f8f2">y)</span>
      <span style="color: #f8f8f2">x</span> <span style="color: #f92672">/</span> <span style="color: #f8f8f2">y</span>
    <span style="color: #66d9ef">end</span>
  <span style="color: #66d9ef">end</span>
<span style="color: #66d9ef">end</span>

<span style="color: #66d9ef">module</span> <span style="color: #f8f8f2">C</span>
  <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">DivideToNumbers</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">initialize</span><span style="color: #f8f8f2">(x,</span> <span style="color: #f8f8f2">y)</span>
      <span style="color: #f8f8f2">@x</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">x</span>
      <span style="color: #f8f8f2">@y</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">y</span>
    <span style="color: #66d9ef">end</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">call</span>
      <span style="color: #f8f8f2">@x</span> <span style="color: #f92672">/</span> <span style="color: #f8f8f2">@y</span>
    <span style="color: #66d9ef">end</span>
  <span style="color: #66d9ef">end</span>
<span style="color: #66d9ef">end</span>

<span style="color: #f8f8f2">require</span> <span style="color: #e6db74">&#39;benchmark&#39;</span>

<span style="color: #66d9ef">Benchmark</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">bmbm</span> <span style="color: #66d9ef">do</span> <span style="color: #f92672">|</span><span style="color: #f8f8f2">x</span><span style="color: #f92672">|</span>
  <span style="color: #f8f8f2">x</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">report(</span><span style="color: #e6db74">&quot;m &quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span> <span style="color: #e6db74">M</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">:DivideToNumbers</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">call(</span><span style="color: #ae81ff">3</span><span style="color: #f92672">.</span><span style="color: #ae81ff">1415926535897932384626</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">61803398874989484820</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">x</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">report(</span><span style="color: #e6db74">&quot;c &quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span> <span style="color: #e6db74">C</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">:DivideToNumbers</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new(</span><span style="color: #ae81ff">3</span><span style="color: #f92672">.</span><span style="color: #ae81ff">1415926535897932384626</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">61803398874989484820</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">call</span> <span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">end</span>
    </pre>
</div>
<p>
    Huh! Ok, there is a difference. I'm more curious though in the amount of instantiated objects.

</p>
<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="background-color:transparent;margin: 0; line-height: 125%">Rehearsal --------------------------------------
m    0.000011   0.000007   0.000018 <span style="color: #f92672">(</span>  0.000009<span style="color: #f92672">)</span>
c    0.000009   0.000002   0.000011 <span style="color: #f92672">(</span>  0.000010<span style="color: #f92672">)</span>
----------------------------- total: 0.000029sec

         user     system      total        real
m    0.000011   0.000002   0.000013 <span style="color: #f92672">(</span>  0.000006<span style="color: #f92672">)</span>
c    0.000011   0.000002   0.000013 <span style="color: #f92672">(</span>  0.000008<span style="color: #f92672">)</span>
    </pre>
</div>
<p>
    The stats for the class approach are:
</p>
<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="background-color:transparent;margin: 0; line-height: 125%"><span style="color: #f8f8f2">{</span>
  <span style="color: #e6db74">:TOTAL</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">17934</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:FREE</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">283</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_OBJECT</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">372</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_CLASS</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">627</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_MODULE</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">38</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_FLOAT</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_STRING</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">9797</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_REGEXP</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">85</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_ARRAY</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">1422</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_HASH</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">120</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_STRUCT</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">14</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_BIGNUM</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_FILE</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_DATA</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">287</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_MATCH</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_COMPLEX</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_SYMBOL</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">28</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_IMEMO</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">4773</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_ICLASS</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">48</span>
<span style="color: #f8f8f2">}</span>
    </pre>
</div>
<p>
    and the stats for the module approach are:
</p>
<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="background-color:transparent;margin: 0; line-height: 125%"><span style="color: #f8f8f2">{</span>
  <span style="color: #e6db74">:TOTAL</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">17938</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:FREE</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">302</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_OBJECT</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">371</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_CLASS</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">626</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_MODULE</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">39</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_FLOAT</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_STRING</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">9789</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_REGEXP</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">85</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_ARRAY</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">1419</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_HASH</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">120</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_STRUCT</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">14</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_BIGNUM</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_FILE</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_DATA</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">287</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_MATCH</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_COMPLEX</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_SYMBOL</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">28</span><span style="color: #f8f8f2">,</span> 
  <span style="color: #e6db74">:T_IMEMO</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">4770</span><span style="color: #f8f8f2">,</span>
  <span style="color: #e6db74">:T_ICLASS</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">48</span>
<span style="color: #f8f8f2">}</span>
    </pre>
</div>

<p>
    ooooook! there was a difference in objects creation after all. My concern started because I realized of the following:
</p>

<div style="background: #272822; overflow:auto;width:auto;color:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="background-color:transparent;margin: 0; line-height: 125%"><span style="color: #f92672">[</span><span style="color: #ae81ff">2</span><span style="color: #f92672">.</span><span style="color: #ae81ff">7</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]&gt;</span> <span style="color: #66d9ef">Module</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">class</span>
<span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">Class</span>
<span style="color: #f92672">[</span><span style="color: #ae81ff">2</span><span style="color: #f92672">.</span><span style="color: #ae81ff">7</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]&gt;</span> <span style="color: #66d9ef">Module</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">superclass</span>
<span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">Object</span>
<span style="color: #f92672">[</span><span style="color: #ae81ff">2</span><span style="color: #f92672">.</span><span style="color: #ae81ff">7</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]&gt;</span> <span style="color: #66d9ef">Class</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">class</span>
<span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">Class</span>
<span style="color: #f92672">[</span><span style="color: #ae81ff">2</span><span style="color: #f92672">.</span><span style="color: #ae81ff">7</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]&gt;</span> <span style="color: #66d9ef">Class</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">superclass</span>
<span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">Module</span>
<span style="color: #f92672">[</span><span style="color: #ae81ff">2</span><span style="color: #f92672">.</span><span style="color: #ae81ff">7</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]&gt;</span>
</pre></div>
<p>
    So, <em>Module</em> and <em>Class</em> have the same class. What does the superclass method do? <a href="https://ruby-doc.org/core-2.6.1/Class.html#method-i-superclass">Returns the superclass of class, or nil.</a> Although, the superclass method is only in <em>Class</em> not in <em>Module</em>.
    And that's how this mystery appeared in the first place.
</p>
</article>
